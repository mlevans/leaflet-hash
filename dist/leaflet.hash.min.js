(function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},s=[].indexOf||function(t){for(var e=0,s=this.length;e<s;e++){if(e in this&&this[e]===t)return e}return-1},i=[].slice;t=function(){function t(t,s){this.map=t;this.options=s!=null?s:{};this.setOverlay=e(this.setOverlay,this);this.setBase=e(this.setBase,this);this.getLayers=e(this.getLayers,this);this.remove=e(this.remove,this);this.formatHash=e(this.formatHash,this);if(!this.options.path){if(this.options.lc){this.options.path="{z}/{lat}/{lng}/{base}"}else{this.options.path="{z}/{lat}/{lng}"}}if(history.pushState){if(this.map._loaded){this.withPushState()}else{this.map.on("load",this.withPushState)}}else{if(this.map._loaded){this.withoutPushState()}else{this.map.on("load",this.withPushState)}}}t.prototype.withPushState=function(){var t,e=this;window.onpopstate=function(t){if(t.state){e.map.setView(t.state.center,t.state.zoom);if(t.state.base){return e.setBase(t.state.base)}}};if(location.hash){t=this.parseHash(location.hash);this.map.setView(t.center,t.zoom);if(t.base){this.setBase(t.base)}}else{history.replaceState.apply(history,this.formatHash())}return this.map.on("moveend baselayerchange",function(){var t;t=e.formatHash();if(location.hash!==t[2]){return history.pushState.apply(history,t)}})};t.prototype.withoutPushState=function(){var t,e,s=this;if(location.hash){e=this.parseHash(location.hash);this.map.setView(e.center,e.zoom);if(e.base){this.setBase(e.base)}}else{location.hash=this.formatHash()[2]}this.map.on("moveend baselayerchange",function(){var t;t=s.formatHash();if(location.hash!==t[2]){return location.hash=t[2]}});if("onhashchange"in window&&(window.documentMode===void 0||window.documentMode>7)){return window.onhashchange=function(){if(location.hash){e=s.parseHash(location.hash);return s.map.setView(e.center,e.zoom)}}}else{t=function(){var t;t=s.formatHash();if(location.hash!==t[2]){return location.hash=t[2]}};return this.hashChangeInterval=setInterval(t,50)}};t.prototype.parseHash=function(t){var e,s,i,n,a,o,h,r,l,c;r=this.options.path.split("/");l=r.indexOf("{z}");n=r.indexOf("{lat}");a=r.indexOf("{lng}");if(this.options.lc){s=r.indexOf("{base}")}if(t.indexOf("#")===0){t=t.substr(1)}e=t.split("/");if(e.length>2){c=parseInt(e[l],10);i=parseFloat(e[n]);o=parseFloat(e[a]);if(isNaN(c)||isNaN(i)||isNaN(o)){false}else{h={center:new L.LatLng(i,o),zoom:c}}if(e.length>3){h.base=e[s]}return h}else{return false}};t.prototype.formatHash=function(){var t,e,s,i,n,a;t=this.map.getCenter();a=this.map.getZoom();s=Math.max(0,Math.ceil(Math.log(a)/Math.LN2));i={center:t,zoom:a};n={lat:t.lat.toFixed(s),lng:t.lng.toFixed(s),z:a};if(this.options.lc){e=this.getLayers();i.base=e[0];n.base=e[0]}return[i,"a","#"+L.Util.template(this.options.path,n)]};t.prototype.remove=function(){this.map.off("moveend");if(window.onpopstate){window.onpopstate=null}return location.hash=""};t.prototype.getLayers=function(){var t,e;e=["",[]];for(t in this.options.lc._layers){if(this.map._layers[t]){if(this.options.lc._layers[t].overlay){e[1].push(this.options.lc._layers[t].name)}else{e[0]=this.options.lc._layers[t].name}}}return e};t.prototype.setBase=function(t){var e,s,i;e=this.options.lc._container.children[1].children[0].children;i=e.length;s=0;while(s<i){if(e[s].children[1].innerHTML.slice(1)===t){e[s].children[0].checked=true}s++}return this.options.lc._onInputClick()};t.prototype.setOverlay=function(t){var e,i,n,a,o;if(t==="-"){return}a=t.split(",");n=this.options.lc._container.children[1].children[2].children;i=n.length;e=0;while(e<i){if(o=n[e].children[1].innerHTML.slice(1),s.call(a,o)>=0){n[e].children[0].checked=true}else{n[e].children[0].checked=false}e++}return this.options.lc._onInputClick()};return t}();L.Hash=t;L.hash=function(){var t;t=1<=arguments.length?i.call(arguments,0):[];return function(t,e,s){s.prototype=t.prototype;var i=new s,n=t.apply(i,e);return Object(n)===n?n:i}(L.Hash,t,function(){})};L.Map.include({addHash:function(){var e,s=this;e=1<=arguments.length?i.call(arguments,0):[];if(this._loaded){this._hash=function(t,e,s){s.prototype=t.prototype;var i=new s,n=t.apply(i,e);return Object(n)===n?n:i}(t,[this].concat(i.call(e)),function(){})}else{this.on("load",function(){return s._hash=function(t,e,s){s.prototype=t.prototype;var i=new s,n=t.apply(i,e);return Object(n)===n?n:i}(t,[s].concat(i.call(e)),function(){})})}return this},removeHash:function(){this._hash.remove();return this}})}).call(this);